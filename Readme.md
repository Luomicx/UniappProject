# 医疗预约系统

## 技术栈
- 前端框架: [uni-app](https://uniapp.dcloud.io/) (Vue.js 3 + TypeScript)
- UI库: [uView Plus](https://www.uviewplus.com/)
- 状态管理: [Pinia](https://pinia.vuejs.org/)
- 构建工具: [Vite](https://vitejs.dev/)
- 后端框架: [Node.js](https://nodejs.org/) with [Express](https://expressjs.com/)
- 数据库: [MongoDB](https://www.mongodb.com/) (通过api目录下的medical-records.js等文件可观察到)

## 项目结构说明
- `pages/` 目录包含所有页面组件（患者/医生/登录等）
- `components/` 目录包含可复用组件（如自定义tabbar）
- `api/` 目录包含后端接口实现
- `store/` 目录包含状态管理模块
- `utils/` 目录包含工具函数（如请求封装、日志记录）

## 快速开始
1. 安装依赖
```bash
npm install
```
2. 启动开发服务器
```bash
npm run dev
```
3. 构建生产版本
```bash
npm run build
```

## 目录结构
```
├── App.vue              # 入口组件
├── main.js              # 入口文件
├── pages.json           # 页面配置文件
├── package.json         # 项目依赖配置
├── vite.config.js       # Vite配置
├── api/                 # 后端接口实现
├── components/          # 组件库

- **IDE**: HBuilderX (uni-app官方推荐IDE)
- **版本控制**: Git (分布式版本控制系统)
- **调试工具**: 微信开发者工具 (用于小程序调试)
- **API测试**: Postman (API开发和测试工具)

## 3. 系统架构

### 3.1 整体架构

本项目采用前后端分离的架构设计，前端使用uni-app框架开发跨平台应用，后端提供RESTful API服务，AI服务则作为独立的微服务模块提供图像识别和自然语言处理能力。

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│             │    │             │    │             │
│  前端应用   │◄───►│  后端服务   │◄───►│  AI服务     │
│  (uni-app)  │    │  (RESTful)  │    │  (微服务)   │
│             │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
```

### 3.2 前端架构

前端采用基于Vue.js的MVVM架构模式，通过uni-app实现跨平台开发，支持微信小程序、H5等多端部署。

```
┌─────────────────────────────────────────────────┐
│                    应用层                        │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│  │ 患者端  │  │ 医生端  │  │ 公共组件   │          │
│  └─────────┘  └─────────┘  └─────────┘          │
├─────────────────────────────────────────────────┤
│                    核心层                        │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│  │ 状态管理 │  │ 路由管理 │  │ API服务 │          │
│  └─────────┘  └─────────┘  └─────────┘          │
├─────────────────────────────────────────────────┤
│                    基础层                        │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│  │ UI组件  │  │ 工具函数 │  │ 配置管理 │          │
│  └─────────┘  └─────────┘  └─────────┘          │
└─────────────────────────────────────────────────┘
```

### 3.3 数据流架构

采用单向数据流架构，通过Pinia进行状态管理，确保数据流向清晰可预测。

```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│         │    │         │    │         │    │         │
│  Action │───►│  Store  │───►│  State  │───►│  View   │
│         │    │         │    │         │    │         │
└─────────┘    └─────────┘    └─────────┘    └─────────┘
                                                  │
                                                  │
                                                  ▼
                                            ┌─────────┐
                                            │         │
                                            │  Event  │
                                            │         │
                                            └─────────┘
                                                  │
                                                  │
                                                  ▼
                                            ┌─────────┐
                                            │         │
                                            │ Action  │
                                            │         │
                                            └─────────┘
```

## 4. 功能模块

### 4.1 用户认证模块

#### 4.1.1 登录/注册

系统提供手机号注册和登录功能，采用OAuth 2.0认证机制，支持密码强度检测和手机号格式验证，确保用户账号安全。

#### 4.1.2 角色选择

系统支持患者和医生两种角色，用户可以在登录后选择相应角色进入不同的功能界面。

#### 4.1.3 个人信息管理

用户可以管理个人基本信息，包括姓名、性别、年龄、联系方式等，医生用户还可以管理专业信息，如职称、擅长领域等。

### 4.2 AI诊断模块

#### 4.2.1 图像采集

支持拍照和从相册选择图片两种方式采集皮肤病图像，并进行图像压缩和优化处理，确保上传质量和效率。

#### 4.2.2 AI分析

采用深度学习模型对皮肤病图像进行分析，识别可能的疾病类型，并提供置信度评分和分析方法说明。

#### 4.2.3 诊断结果展示

以可视化方式展示AI诊断结果，包括疾病名称、置信度、分析方法、用药建议等，并提供免责声明。

### 4.3 医患交互模块

#### 4.3.1 预约挂号

患者可以选择医生、日期和时间段进行在线预约，系统自动检查时间段可用性，并提供预约确认和取消功能。

#### 4.3.2 医生工作台

医生可以查看预约列表，处理患者预约请求，提供诊疗建议，并管理自己的排班时间。

#### 4.3.3 在线咨询

患者可以与医生进行在线文字咨询，系统保存咨询记录，方便后续追踪和查看。

### 4.4 病历管理模块

#### 4.4.1 病历记录

系统自动生成并保存患者的病历记录，包括基本信息、症状描述、诊断结果、治疗建议等。

#### 4.4.2 病历查询

患者和医生都可以查询历史病历，系统提供按时间、状态等条件筛选功能。

#### 4.4.3 病历详情

提供病历详细信息查看，包括患者信息、医生信息、诊断结果、治疗建议、时间信息等。

### 4.5 AI健康助手模块

#### 4.5.1 智能问答

基于自然语言处理技术，提供健康问题的智能问答服务，支持常见皮肤病症状、预防、治疗等问题的咨询。

#### 4.5.2 历史记录

保存用户与AI助手的对话历史，支持查看和继续之前的对话。

### 4.6 社区交流模块

#### 4.6.1 帖子发布

用户可以发布健康相关的帖子，分享经验和问题。

#### 4.6.2 评论互动

支持帖子评论和回复功能，促进用户间的交流和互动。

## 5. 数据模型

### 5.1 用户数据模型

```json
{
  "id": "用户唯一标识",
  "phone_number": "手机号",
  "role": "角色(patient/doctor)",
  "created_at": "创建时间",
  "updated_at": "更新时间"
}
```

### 5.2 患者数据模型

```json
{
  "id": "患者唯一标识",
  "user_id": "关联用户ID",
  "name": "姓名",
  "gender": "性别",
  "age": "年龄",
  "id_card": "身份证号",
  "marital_status": "婚姻状况",
  "ethnicity": "民族",
  "residence": "居住地",
  "birth_date": "出生日期",
  "phone_number": "联系电话",
  "created_at": "创建时间",
  "updated_at": "更新时间"
}
```

### 5.3 医生数据模型

```json
{
  "id": "医生唯一标识",
  "user_id": "关联用户ID",
  "name": "姓名",
  "gender": "性别",
  "working_years": "工作年限",
  "hospital": "所属医院",
  "title": "职称",
  "registration_fee": "挂号费",
  "introduction": "个人简介",
  "expertise": "专业领域",
  "payment_qr_code": "支付二维码",
  "created_at": "创建时间",
  "updated_at": "更新时间"
}
```

### 5.4 病历数据模型

```json
{
  "id": "病历唯一标识",
  "patient_id": "患者ID",
  "doctor_id": "医生ID",
  "name": "患者姓名",
  "gender": "性别",
  "age": "年龄",
  "phone_number": "联系电话",
  "symptoms_description": "症状描述",
  "detailed_description": "详细描述",
  "condition_analysis": "病情分析",
  "drug_recommendation": "用药建议",
  "image_url": "图片URL",
  "image_base64": "图片Base64数据",
  "confidence": "AI诊断置信度",
  "disclaimer": "免责声明",
  "created_at": "创建时间",
  "updated_at": "更新时间"
}
```

### 5.5 预约数据模型

```json
{
  "id": "预约唯一标识",
  "patient_id": "患者ID",
  "doctor_id": "医生ID",
  "appointment_date": "预约日期",
  "appointment_time": "预约时间段",
  "status": "状态(pending/confirmed/cancelled/completed)",
  "symptoms": "症状描述",
  "created_at": "创建时间",
  "updated_at": "更新时间"
}
```

## 6. API设计

### 6.1 认证API

| 接口名称     | 请求方法 | 接口路径              | 功能描述         |
| ------------ | -------- | --------------------- | ---------------- |
| 用户注册     | POST     | /register/            | 创建新用户账号   |
| 用户登录     | POST     | /token/               | 获取访问令牌     |
| 选择身份     | POST     | /select_identity/     | 选择用户角色     |
| 创建患者信息 | POST     | /create_patient_info/ | 创建患者个人信息 |
| 创建医生信息 | POST     | /create_doctor_info/  | 创建医生个人信息 |
| 获取用户信息 | GET      | /user/info/           | 获取当前用户信息 |
| 更新用户信息 | PUT      | /user/info/           | 更新用户个人信息 |

### 6.2 AI诊断API

| 接口名称       | 请求方法 | 接口路径                         | 功能描述                   |
| -------------- | -------- | -------------------------------- | -------------------------- |
| 皮肤病图像分析 | POST     | /aliyun_predict/detect-by-upload | 上传图像并获取初步分析结果 |
| 疾病详细分析   | GET      | /sparkapi/illness_analysis       | 根据疾病名称获取详细分析   |
| 全面诊断       | POST     | /diagnose/full-diagnosis         | 上传图像并获取完整诊断结果 |
| AI健康咨询     | GET      | /ai_chat/communicate             | 与AI健康助手进行对话       |

### 6.3 医患交互API

| 接口名称         | 请求方法 | 接口路径                            | 功能描述               |
| ---------------- | -------- | ----------------------------------- | ---------------------- |
| 创建预约         | POST     | /appointment/create/                | 创建新的预约记录       |
| 获取预约列表     | GET      | /appointment/list/                  | 获取预约记录列表       |
| 获取预约详情     | GET      | /appointment/detail/                | 获取预约详细信息       |
| 确认预约         | POST     | /appointment/confirm/               | 医生确认预约           |
| 取消预约         | POST     | /appointment/cancel/                | 取消预约记录           |
| 检查时间段可用性 | GET      | /appointment/check_availability/    | 检查预约时间段是否可用 |
| 提交诊疗建议     | POST     | /doctor_patient_form/submit_advice/ | 医生提交诊疗建议       |

### 6.4 病历管理API

| 接口名称       | 请求方法 | 接口路径                                          | 功能描述           |
| -------------- | -------- | ------------------------------------------------- | ------------------ |
| 获取病历列表   | GET      | /medical_records/list/                            | 获取病历记录列表   |
| 获取病历详情   | GET      | /medical_records/detail/                          | 获取病历详细信息   |
| 获取病历单列表 | GET      | /doctor_patient_form/doctor_patient_forms/list/   | 获取病历单列表     |
| 获取病历单详情 | GET      | /doctor_patient_form/doctor_patient_forms/detail/ | 获取病历单详细信息 |

## 7. 前端实现

### 7.1 目录结构

```
Test/
├── api/                # API接口封装
│   ├── ai.js           # AI相关API
│   ├── auth.js         # 认证相关API
│   ├── doctor.js       # 医生相关API
│   ├── medical.js      # 医疗相关API
│   └── patient.js      # 患者相关API
├── components/         # 公共组件
│   ├── custom-tab-bar.vue  # 自定义底部导航栏
│   └── doctor-tab-bar.vue  # 医生端底部导航栏
├── config/             # 配置文件
│   └── index.js        # 环境配置
├── pages/              # 页面文件
│   ├── choose-role/    # 角色选择页面
│   ├── doctor/         # 医生端页面
│   ├── login/          # 登录注册页面
│   └── patient/        # 患者端页面
├── static/             # 静态资源
│   ├── ai-avatar.svg   # AI头像
│   └── user-avatar.svg # 用户头像
├── store/              # 状态管理
│   ├── tabBar.js       # 导航栏状态
│   └── userInfo.js     # 用户信息状态
├── utils/              # 工具函数
│   ├── logger.js       # 日志工具
│   └── request.js      # 请求工具
├── App.vue             # 应用入口组件
├── main.js             # 应用入口文件
├── pages.json          # 页面配置
├── package.json        # 项目依赖
└── vite.config.js      # Vite配置
```

### 7.2 组件设计

项目采用组件化开发方式，将UI界面拆分为可复用的组件，提高代码复用率和可维护性。主要组件包括：

- **自定义导航栏**: 根据不同角色显示不同的导航选项
- **状态卡片**: 显示病历、预约等状态信息
- **信息卡片**: 展示患者、医生、病历等详细信息
- **表单组件**: 用于用户输入和数据提交
- **列表组件**: 展示病历、预约等列表数据
- **对话组件**: 用于AI助手和在线咨询的对话界面

### 7.3 状态管理

使用Pinia进行状态管理，主要包括以下Store：

- **userInfoStore**: 管理用户信息状态
- **tabBarStore**: 管理导航栏状态
- **analysisStore**: 管理AI分析结果状态

### 7.4 路由管理

通过uni-app的页面路由机制，实现页面间的跳转和参数传递，主要包括：

- **tabBar页面**: 通过底部导航栏直接访问的主要页面
- **非tabBar页面**: 通过导航API访问的详情、表单等页面

## 8. UI/UX设计

### 8.1 设计风格

采用现代简约的设计风格，以蓝色为主色调，搭配白色和浅灰色背景，营造专业、清爽的医疗应用氛围。

### 8.2 交互设计

- **直观的导航**: 通过底部导航栏和顶部标题栏，提供清晰的导航路径
- **状态反馈**: 通过颜色、图标和文字，直观展示操作状态和结果
- **加载状态**: 使用加载动画和进度提示，减少用户等待焦虑
- **手势操作**: 支持下拉刷新、滑动查看等常见手势操作

### 8.3 响应式设计

采用弹性布局和相对单位，确保应用在不同尺寸的设备上都能有良好的显示效果。

## 9. 性能优化

### 9.1 图片优化

- **图片压缩**: 上传前对图片进行压缩，减少传输数据量
- **懒加载**: 列表中的图片采用懒加载方式，提高页面加载速度
- **缓存策略**: 对常用图片资源进行缓存，减少重复请求

### 9.2 网络优化

- **请求合并**: 减少API请求次数，合并相关数据请求
- **错误重试**: 对网络请求失败进行自动重试，提高成功率
- **状态监测**: 实时监测网络状态，在弱网环境下提供适当提示

### 9.3 代码优化

- **代码分割**: 按需加载组件和页面，减少初始加载时间
- **缓存管理**: 合理使用本地存储，减少不必要的网络请求
- **防抖节流**: 对频繁触发的事件进行防抖和节流处理

## 10. 安全措施

### 10.1 数据安全

- **HTTPS传输**: 所有API请求使用HTTPS协议，确保数据传输安全
- **敏感信息加密**: 对用户密码等敏感信息进行加密存储
- **数据脱敏**: 展示用户手机号等信息时进行部分隐藏

### 10.2 认证授权

- **Token认证**: 采用OAuth 2.0认证机制，使用Bearer Token进行API认证
- **权限控制**: 根据用户角色控制功能访问权限
- **Token过期处理**: 自动处理Token过期情况，引导用户重新登录

### 10.3 输入验证

- **表单验证**: 对用户输入进行前端验证，确保数据格式正确
- **参数过滤**: 对API请求参数进行过滤和验证，防止注入攻击
- **错误处理**: 完善的错误处理机制，避免敏感信息泄露

## 11. 部署与发布

### 11.1 环境配置

项目支持多环境配置，包括开发环境、真机调试环境和生产环境，通过配置文件进行管理：

```javascript
export const ENV = {
  development: false,  // 开发环境标识
  baseUrl: {
    development: 'http://127.0.0.1:8000',  // 开发环境API地址
    deviceDebug: 'http://192.168.1.100:8000',  // 真机调试环境API地址
    production: 'https://api.example.com'  // 生产环境API地址
  },
  debug: false,  // 调试模式标识
  version: '1.0.0'  // 应用版本号
}
```

### 11.2 打包发布

使用uni-app的打包功能，可以生成不同平台的应用包：

- **微信小程序**: 生成微信小程序代码包，通过微信开发者工具上传发布
- **H5**: 生成Web应用，可部署到Web服务器
- **App**: 生成Android和iOS应用安装包

### 11.3 发布检查清单

发布前需要进行以下检查：

- 将环境配置中的`development`和`debug`设置为`false`
- 更新生产环境的API地址
- 更新应用版本号
- 移除所有调试代码和注释
- 测试所有功能和页面
- 检查性能和兼容性

## 12. 未来展望

### 12.1 功能扩展

- **多语言支持**: 添加多语言支持，扩大应用受众
- **视频咨询**: 增加医患视频咨询功能，提供更直观的远程诊疗体验
- **健康管理**: 添加健康数据记录和分析功能，提供个性化健康管理服务

### 12.2 技术升级

- **AI模型优化**: 持续优化AI诊断模型，提高识别准确率
- **离线功能**: 增加离线数据存储和同步功能，提升弱网环境下的用户体验
- **WebRTC集成**: 集成WebRTC技术，实现实时音视频通信

### 12.3 生态拓展

- **医院合作**: 与医院建立合作关系，实现线上线下一体化服务
- **保险对接**: 与医疗保险系统对接，提供保险理赔服务
- **药店合作**: 与药店合作，提供在线购药和配送服务

## 13. 总结

AI皮肤病诊断系统是一款融合了人工智能技术和医疗服务的创新应用，通过前沿的深度学习算法和用户友好的界面设计，为用户提供便捷、高效的皮肤病诊断和医疗咨询服务。系统采用前后端分离架构，使用uni-app框架实现跨平台开发，具有良好的可扩展性和可维护性。

通过本项目的实施，不仅提高了皮肤病诊断的可及性和便捷性，也为医患沟通搭建了新的桥梁，对推动医疗服务数字化转型具有积极意义。未来，随着AI技术的不断发展和医疗资源的进一步整合，系统将持续优化和扩展，为用户提供更全面、更精准的医疗健康服务。 